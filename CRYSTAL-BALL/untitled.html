<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title> 水晶球試作 </title>
<script src="https://d3js.org/d3.v7.min.js"></script> 
<!--<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>--> 
<script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>
<style id="plotly.js-style-global"></style>
<!-- Icon Font Stylesheet -->
<link rel="stylesheet" href="http://140.122.118.47/careerinfo/Content/lib/bootstrap-icons-1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
<form name="form1" method="post" action="./3d2.aspx" id="form1">
  <div>
    <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMTg0NTQzNjEPFgIeE1ZhbGlkYXRlUmVxdWVzdE1vZGUCAWRk41qxnYJmb+om/a/R1LKF/CC4Ep+tZlCmzeQy3qPINBk=">
  </div>
  <div>
    <input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="72DD9A14">
  </div>
  <div style="display: flex; flex-direction: row; width: 100%; height: 100vh;"> 
    
    <!-- 左側：3D 圖表區 -->
    <div id="plotArea" style="flex: 1; position: relative; border-right: 2px solid green;">
      <div id="myDiv" style="width: 100%; height: 100%;" class="js-plotly-plot">
        <div class="plot-container plotly" style="width: 100%; height: 100%;">
          <div class="user-select-none svg-container" style="position: relative; width: 1387px; height: 945px;">
            <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1387" height="945" style="background: white;">
              <defs id="defs-68c867">
                <g class="clips"></g>
                <g class="gradients"></g>
                <g class="patterns"></g>
              </defs>
              <g class="bglayer"></g>
              <g class="draglayer"></g>
              <g class="layer-below">
                <g class="imagelayer"></g>
                <g class="shapelayer"></g>
              </g>
              <g class="cartesianlayer"></g>
              <g class="polarlayer"></g>
              <g class="smithlayer"></g>
              <g class="ternarylayer"></g>
              <g class="geolayer"></g>
              <g class="funnelarealayer"></g>
              <g class="pielayer"></g>
              <g class="iciclelayer"></g>
              <g class="treemaplayer"></g>
              <g class="sunburstlayer"></g>
              <g class="glimages"></g>
            </svg>
            <div class="gl-container">
              <div id="scene" style="position: absolute; left: 0px; top: 0px; height: 945px; width: 1221px;">
                <svg viewBox="0 0 1221 945" width="1221" height="945" style="position: absolute; left: 0px; top: 0px; height: 100%; width: 100%; z-index: 20; pointer-events: none;"></svg>
                <canvas width="2442" height="1890" style="position: absolute; left: 0px; top: 0px; width: 1221px; height: 945px;"></canvas>
              </div>
            </div>
            <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1387" height="945">
              <defs id="topdefs-68c867">
                <g class="clips"></g>
                <clipPath id="legend68c867">
                  <rect width="105" height="145" x="0" y="0"></rect>
                </clipPath>
              </defs>
              <g class="indicatorlayer"></g>
              <g class="layer-above">
                <g class="imagelayer"></g>
                <g class="shapelayer"></g>
              </g>
              <g class="selectionlayer"></g>
              <g class="infolayer">
                <g class="legend" pointer-events="all" transform="translate(1282,400)">
                  <rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="105" height="145" x="0" y="0"></rect>
                  <g class="scrollbox" transform="" clip-path="url(#legend68c867)">
                    <g class="groups" transform="">
                      <g class="traces" transform="translate(0,14.5)" style="opacity: 1;">
                        <text class="legendtext" text-anchor="start" x="40" y="4.680000000000001" data-unformatted="近" data-math="N" style="font-family: &quot;Open Sans&quot;, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; font-weight: normal; font-style: normal; font-variant: normal; white-space: pre;">近</text>
                        <g class="layers" style="opacity: 1;">
                          <g class="legendfill"></g>
                          <g class="legendlines"></g>
                          <g class="legendsymbols">
                            <g class="legendpoints">
                              <path class="scatterpts" transform="translate(20,0)" d="M3.5,0A3.5,3.5 0 1,1 0,-3.5A3.5,3.5 0 0,1 3.5,0Z" style="opacity: 0.8; stroke-width: 0.5px; fill: rgb(0, 128, 128); fill-opacity: 1; stroke: rgb(217, 217, 217); stroke-opacity: 0.14;"></path>
                            </g>
                          </g>
                        </g>
                        <rect class="legendtoggle" pointer-events="all" x="0" y="-9.5" width="100" height="19" style="cursor: pointer; fill: rgb(0, 0, 0); fill-opacity: 0;"></rect>
                      </g>
                    </g>
                    <g class="groups" transform="translate(0,10)">
                      <g class="traces" transform="translate(0,33.5)" style="opacity: 1;">
                        <text class="legendtext" text-anchor="start" x="40" y="4.680000000000001" data-unformatted="中" data-math="N" style="font-family: &quot;Open Sans&quot;, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; font-weight: normal; font-style: normal; font-variant: normal; white-space: pre;">中</text>
                        <g class="layers" style="opacity: 1;">
                          <g class="legendfill"></g>
                          <g class="legendlines"></g>
                          <g class="legendsymbols">
                            <g class="legendpoints">
                              <path class="scatterpts" transform="translate(20,0)" d="M3.5,0A3.5,3.5 0 1,1 0,-3.5A3.5,3.5 0 0,1 3.5,0Z" style="opacity: 0.8; stroke-width: 0.5px; fill: rgb(255, 215, 0); fill-opacity: 1; stroke: rgb(217, 217, 217); stroke-opacity: 0.14;"></path>
                            </g>
                          </g>
                        </g>
                        <rect class="legendtoggle" pointer-events="all" x="0" y="-9.5" width="100" height="19" style="cursor: pointer; fill: rgb(0, 0, 0); fill-opacity: 0;"></rect>
                      </g>
                    </g>
                    <g class="groups" transform="translate(0,20)">
                      <g class="traces" transform="translate(0,52.5)" style="opacity: 1;">
                        <text class="legendtext" text-anchor="start" x="40" y="4.680000000000001" data-unformatted="遠" data-math="N" style="font-family: &quot;Open Sans&quot;, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; font-weight: normal; font-style: normal; font-variant: normal; white-space: pre;">遠</text>
                        <g class="layers" style="opacity: 1;">
                          <g class="legendfill"></g>
                          <g class="legendlines"></g>
                          <g class="legendsymbols">
                            <g class="legendpoints">
                              <path class="scatterpts" transform="translate(20,0)" d="M3.5,0A3.5,3.5 0 1,1 0,-3.5A3.5,3.5 0 0,1 3.5,0Z" style="opacity: 0.8; stroke-width: 0.5px; fill: rgb(75, 0, 130); fill-opacity: 1; stroke: rgb(217, 217, 217); stroke-opacity: 0.14;"></path>
                            </g>
                          </g>
                        </g>
                        <rect class="legendtoggle" pointer-events="all" x="0" y="-9.5" width="100" height="19" style="cursor: pointer; fill: rgb(0, 0, 0); fill-opacity: 0;"></rect>
                      </g>
                    </g>
                    <g class="groups" transform="translate(0,30)">
                      <g class="traces" transform="translate(0,71.5)" style="opacity: 1;">
                        <text class="legendtext" text-anchor="start" x="40" y="4.680000000000001" data-unformatted="本人" data-math="N" style="font-family: &quot;Open Sans&quot;, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; font-weight: normal; font-style: normal; font-variant: normal; white-space: pre;">本人</text>
                        <g class="layers" style="opacity: 1;">
                          <g class="legendfill"></g>
                          <g class="legendlines"></g>
                          <g class="legendsymbols">
                            <g class="legendpoints">
                              <path class="scatterpts" transform="translate(20,0)" d="M3.5,0A3.5,3.5 0 1,1 0,-3.5A3.5,3.5 0 0,1 3.5,0Z" style="opacity: 0.8; stroke-width: 0.5px; fill: rgb(255, 0, 0); fill-opacity: 1; stroke: rgb(217, 217, 217); stroke-opacity: 0.14;"></path>
                            </g>
                          </g>
                        </g>
                        <rect class="legendtoggle" pointer-events="all" x="0" y="-9.5" width="100" height="19" style="cursor: pointer; fill: rgb(0, 0, 0); fill-opacity: 0;"></rect>
                      </g>
                    </g>
                    <g class="groups" transform="translate(0,40)">
                      <g class="traces" transform="translate(0,90.5)" style="opacity: 1;">
                        <text class="legendtext" text-anchor="start" x="40" y="4.680000000000001" data-unformatted="空間軸標示" data-math="N" style="font-family: &quot;Open Sans&quot;, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; font-weight: normal; font-style: normal; font-variant: normal; white-space: pre;">空間軸標示</text>
                        <g class="layers" style="opacity: 1;">
                          <g class="legendfill"></g>
                          <g class="legendlines"></g>
                          <g class="legendsymbols">
                            <g class="legendpoints">
                              <path class="scatterpts" transform="translate(20,0)" d="M2,0A2,2 0 1,1 0,-2A2,2 0 0,1 2,0Z" style="opacity: 0.8; stroke-width: 0px; fill: rgb(211, 211, 211); fill-opacity: 1;"></path>
                            </g>
                          </g>
                        </g>
                        <rect class="legendtoggle" pointer-events="all" x="0" y="-9.5" width="100" height="19" style="cursor: pointer; fill: rgb(0, 0, 0); fill-opacity: 0;"></rect>
                      </g>
                    </g>
                  </g>
                  <rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"></rect>
                </g>
                <g class="g-gtitle"></g>
              </g>
              <g class="menulayer"></g>
              <g class="zoomlayer"></g>
            </svg>
            <div class="modebar-container" style="position: absolute; top: 0px; right: 0px; width: 100%;">
              <div id="modebar-68c867" class="modebar modebar--hover ease-bg">
                <div class="modebar-group" style="background-color: rgba(255, 255, 255, 0.5);"><a rel="tooltip" class="modebar-btn" data-title="Download plot as a png" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 1000 1000" class="icon" height="1em" width="1em">
                    <path d="m500 450c-83 0-150-67-150-150 0-83 67-150 150-150 83 0 150 67 150 150 0 83-67 150-150 150z m400 150h-120c-16 0-34 13-39 29l-31 93c-6 15-23 28-40 28h-340c-16 0-34-13-39-28l-31-94c-6-15-23-28-40-28h-120c-55 0-100-45-100-100v-450c0-55 45-100 100-100h800c55 0 100 45 100 100v450c0 55-45 100-100 100z m-400-550c-138 0-250 112-250 250 0 138 112 250 250 250 138 0 250-112 250-250 0-138-112-250-250-250z m365 380c-19 0-35 16-35 35 0 19 16 35 35 35 19 0 35-16 35-35 0-19-16-35-35-35z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.3);"></path>
                  </svg>
                  </a></div>
                <div class="modebar-group" style="background-color: rgba(255, 255, 255, 0.5);"><a rel="tooltip" class="modebar-btn" data-title="Zoom" data-attr="scene.dragmode" data-val="zoom" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 1000 1000" class="icon" height="1em" width="1em">
                    <path d="m1000-25l-250 251c40 63 63 138 63 218 0 224-182 406-407 406-224 0-406-182-406-406s183-406 407-406c80 0 155 22 218 62l250-250 125 125z m-812 250l0 438 437 0 0-438-437 0z m62 375l313 0 0-312-313 0 0 312z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.3);"></path>
                  </svg>
                  </a><a rel="tooltip" class="modebar-btn" data-title="Pan" data-attr="scene.dragmode" data-val="pan" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 1000 1000" class="icon" height="1em" width="1em">
                    <path d="m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.3);"></path>
                  </svg>
                  </a><a rel="tooltip" class="modebar-btn" data-title="Orbital rotation" data-attr="scene.dragmode" data-val="orbit" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 1000 1000" class="icon" height="1em" width="1em">
                    <path d="m922 660c-5 4-9 7-14 11-359 263-580-31-580-31l-102 28 58-400c0 1 1 1 2 2 118 108 351 249 351 249s-62 27-100 42c88 83 222 183 347 122 16-8 30-17 44-27-2 1-4 2-6 4z m36-329c0 0 64 229-88 296-62 27-124 14-175-11 157-78 225-208 249-266 8-19 11-31 11-31 2 5 6 15 11 32-5-13-8-20-8-20z m-775-239c70-31 117-50 198-32-121 80-199 346-199 346l-96-15-58-12c0 0 55-226 155-287z m603 133l-317-139c0 0 4-4 19-14 7-5 24-15 24-15s-177-147-389 4c235-287 536-112 536-112l31-22 100 299-4-1z m-298-153c6-4 14-9 24-15 0 0-17 10-24 15z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.3);"></path>
                  </svg>
                  </a><a rel="tooltip" class="modebar-btn active" data-title="Turntable rotation" data-attr="scene.dragmode" data-val="turntable" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 1000 1000" class="icon" height="1em" width="1em">
                    <path d="m833 5l-17 108v41l-130-65 130-66c0 0 0 38 0 39 0-1 36-14 39-25 4-15-6-22-16-30-15-12-39-16-56-20-90-22-187-23-279-23-261 0-341 34-353 59 3 60 228 110 228 110-140-8-351-35-351-116 0-120 293-142 474-142 155 0 477 22 477 142 0 50-74 79-163 96z m-374 94c-58-5-99-21-99-40 0-24 65-43 144-43 79 0 143 19 143 43 0 19-42 34-98 40v216h87l-132 135-133-135h88v-216z m167 515h-136v1c16 16 31 34 46 52l84 109v54h-230v-71h124v-1c-16-17-28-32-44-51l-89-114v-51h245v72z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.7);"></path>
                  </svg>
                  </a></div>
                <div class="modebar-group" style="background-color: rgba(255, 255, 255, 0.5);"><a rel="tooltip" class="modebar-btn" data-title="Reset camera to default" data-attr="resetDefault" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 928.6 1000" class="icon" height="1em" width="1em">
                    <path d="m786 296v-267q0-15-11-26t-25-10h-214v214h-143v-214h-214q-15 0-25 10t-11 26v267q0 1 0 2t0 2l321 264 321-264q1-1 1-4z m124 39l-34-41q-5-5-12-6h-2q-7 0-12 3l-386 322-386-322q-7-4-13-4-7 2-12 7l-35 41q-4 5-3 13t6 12l401 334q18 15 42 15t43-15l136-114v109q0 8 5 13t13 5h107q8 0 13-5t5-13v-227l122-102q5-5 6-12t-4-13z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.3);"></path>
                  </svg>
                  </a><a rel="tooltip" class="modebar-btn" data-title="Reset camera to last save" data-attr="resetLastSave" data-toggle="false" data-gravity="n" data-btn-style-event-added="true">
                  <svg viewBox="0 0 1000 1000" class="icon" height="1em" width="1em">
                    <path d="m938 413l-188-125c0 37-17 71-44 94 64 38 107 107 107 187 0 121-98 219-219 219-121 0-219-98-219-219 0-61 25-117 66-156h-115c30 33 49 76 49 125 0 103-84 187-187 187s-188-84-188-187c0-57 26-107 65-141-38-22-65-62-65-109v-250c0-70 56-126 125-126h500c69 0 125 56 125 126l188-126c34 0 62 28 62 63v375c0 35-28 63-62 63z m-750 0c-69 0-125 56-125 125s56 125 125 125 125-56 125-125-56-125-125-125z m406-1c-87 0-157 70-157 157 0 86 70 156 157 156s156-70 156-156-70-157-156-157z" transform="matrix(1 0 0 -1 0 850)" style="fill: rgba(68, 68, 68, 0.3);"></path>
                  </svg>
                  </a></div>
                <div class="modebar-group" style="background-color: rgba(255, 255, 255, 0.5);"><a href="https://plotly.com/" target="_blank" data-title="Produced with Plotly.js (v3.0.1)" class="modebar-btn plotlyjsicon modebar-btn--logo" data-btn-style-event-added="true">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 132" height="1em" width="1em">
                    <title>plotly-logomark</title>
                    <g id="symbol">
                      <rect fill="#000" x="0" y="0" width="132" height="132" rx="18" ry="18"></rect>
                      <circle fill="#9EF" cx="102" cy="30" r="6"></circle>
                      <circle fill="#BAC" cx="78" cy="30" r="6"></circle>
                      <circle fill="#BAC" cx="78" cy="54" r="6"></circle>
                      <circle fill="#D69" cx="54" cy="30" r="6"></circle>
                      <circle fill="#F26" cx="30" cy="30" r="6"></circle>
                      <circle fill="#F26" cx="30" cy="54" r="6"></circle>
                      <path fill="#FFF" d="M30,72a6,6,0,0,0-6,6v24a6,6,0,0,0,12,0V78A6,6,0,0,0,30,72Z"></path>
                      <path fill="#FFF" d="M78,72a6,6,0,0,0-6,6v24a6,6,0,0,0,12,0V78A6,6,0,0,0,78,72Z"></path>
                      <path fill="#FFF" d="M54,48a6,6,0,0,0-6,6v48a6,6,0,0,0,12,0V54A6,6,0,0,0,54,48Z"></path>
                      <path fill="#FFF" d="M102,48a6,6,0,0,0-6,6v48a6,6,0,0,0,12,0V54A6,6,0,0,0,102,48Z"></path>
                    </g>
                  </svg>
                  </a></div>
              </div>
            </div>
            <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1387" height="945">
              <g class="hoverlayer"></g>
            </svg>
          </div>
        </div>
      </div>
      <button type="button" id="toggleRotation" style="position: absolute; top: 10px; left: 10px; z-index: 10;">旋轉展示</button>
      <button id="highlightBtn" style="position: absolute; top: 50px; left: 10px; z-index: 10;display:none">閃爍心理學類</button>
    </div>
    
    <!-- 右側：學類資訊顯示區 -->
    <div id="infoPanel" style="flex: 0 0 480px; padding: 10px; overflow-y: auto; background: #f9f9f9;">
      <p>生涯水晶球是用三個向度進行學類的分類：X軸是「自由」和「規準」，Y軸是「事」和「人」，Z軸是「思考」和「實踐」。</p>
      <p style="padding-left:1em;"> 如果你喜歡自己決定、創意發想、彈性大，代表你偏向自由；如果你喜歡有計畫、照規則做事，則偏向規準。<br>
        偏好「事」的人喜歡操作、分析、處理資料或解決問題；偏好「人」的人則喜歡互動、幫助別人或一起合作。<br>
        傾向「思考」的人愛分析、推理與理解背後原理；「實踐」的人則喜歡動手做、從實際經驗中學習。<br>
        了解自己在哪些向度比較有興趣，有助於找到適合自己的學習與發展方向。 </p>
      <h4>興趣傾向:</h4>
      <p>依據測驗結果，你的興趣特質傾向<b>重視人際互動、遵守規矩與制度。</b></p>
      <hr>
      <h4>以下是與你特質傾向較為相近的前10個學類：</h4>
      <div id="treeMenu">
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">1. 中國語文學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 中國語文學系</li>
            <li> 華語文學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">2. 國際事務學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 國際事務學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">3. 一般大眾傳播學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 大眾傳播學系</li>
            <li> 傳播管理學系</li>
            <li> 運動資訊傳播學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">4. 圖書資訊檔案學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 圖書資訊學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">5. 企業管理學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 企業管理學系</li>
            <li> 國際企業學系</li>
            <li> 管理科學學系</li>
            <li> 科技管理學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">6. 貿易學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 國際貿易學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">7. 都巿規劃學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 都巿規劃學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">8. 老年服務學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 長期照護與管理學系</li>
            <li> 高齡健康照護學系</li>
            <li> 老人服務事業管理學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">9. 兒童保育學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 兒童保育學系</li>
            <li> 家庭與兒童發展學系</li>
          </ul>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="cursor: pointer; font-weight: bold; color: rgb(51, 102, 204); margin-bottom: 4px;">10. 觀光休閒學類</div>
          <ul style="margin-left: 20px; display: none;">
            <li> 觀光休閒學系</li>
            <li> 觀光休閒管理學系</li>
            <li> 休閒遊憩學系</li>
          </ul>
        </div>
      </div>
      <hr>
      <div> 搜尋學系：
        <input type="text" class="form-control" list="Drop_dept" placeholder="輸入學系關鍵字..." aria-label="輸入學系關鍵字" aria-describedby="button-addon2" id="Searchdeptstr">
        <datalist id="Drop_dept">
          <option value="科學教育學系"></option>
          <option value="教育學系"></option>
          <option value="教育行政學系"></option>
          <option value="公民教育學系"></option>
          <option value="社會教育學系"></option>
          <option value="成人及繼續教育學系"></option>
          <option value="數學教育學系"></option>
          <option value="英語教學學系"></option>
          <option value="語文教育學系"></option>
          <option value="幼兒教育學系"></option>
          <option value="幼兒與家庭教育學系"></option>
          <option value="特殊教育學系"></option>
          <option value="適應體育學系"></option>
          <option value="學習科學學系"></option>
          <option value="教育科技學系"></option>
          <option value="美術學系"></option>
          <option value="書畫藝術學系"></option>
          <option value="雕塑學系"></option>
          <option value="藝術與設計學系"></option>
          <option value="工藝設計學系"></option>
          <option value="美術工藝學系"></option>
          <option value="藝術行政學系"></option>
          <option value="音樂學系"></option>
          <option value="中國音樂學系"></option>
          <option value="應用音樂學系"></option>
          <option value="民族音樂學系"></option>
          <option value="戲曲音樂學系"></option>
          <option value="戲劇學系"></option>
          <option value="表演藝術學系"></option>
          <option value="劇場藝術學系"></option>
          <option value="中國戲劇學系"></option>
          <option value="民俗技藝學系"></option>
          <option value="舞蹈學系"></option>
          <option value="演藝事業管理學系"></option>
          <option value="視覺藝術學系"></option>
          <option value="新媒體藝術學系"></option>
          <option value="多媒體動畫藝術學系"></option>
          <option value="影視創作學系"></option>
          <option value="影視設計學系"></option>
          <option value="臺灣語文學系"></option>
          <option value="中國語文學系"></option>
          <option value="華語文學系"></option>
          <option value="英語學系"></option>
          <option value="應用英語學系"></option>
          <option value="日語學系"></option>
          <option value="應用日語學系"></option>
          <option value="外語學系"></option>
          <option value="應用外語學系"></option>
          <option value="歐洲語言學系"></option>
          <option value="亞洲語言學系"></option>
          <option value="宗教學系"></option>
          <option value="佛教學系"></option>
          <option value="天主教學系"></option>
          <option value="基督教學系"></option>
          <option value="歷史學系"></option>
          <option value="文化資產與發展學系"></option>
          <option value="人類與民族學系"></option>
          <option value="藝術史學系"></option>
          <option value="哲學學系"></option>
          <option value="設計學系"></option>
          <option value="智慧生活設計學系"></option>
          <option value="視覺傳達設計學系"></option>
          <option value="數位媒體設計學系"></option>
          <option value="多媒體設計學系"></option>
          <option value="動畫與遊戲設計學系"></option>
          <option value="互動設計學系"></option>
          <option value="工業設計學系"></option>
          <option value="商業設計學系"></option>
          <option value="文化創意與設計學系"></option>
          <option value="空間設計學系"></option>
          <option value="室內設計學系"></option>
          <option value="全球經濟學系"></option>
          <option value="合作經濟學系"></option>
          <option value="經濟學系"></option>
          <option value="政治學系"></option>
          <option value="社會學系"></option>
          <option value="犯罪防治學系"></option>
          <option value="人文社會學系"></option>
          <option value="教育心理學系"></option>
          <option value="工商心理學系"></option>
          <option value="心理學系"></option>
          <option value="輔導與諮商心理學系"></option>
          <option value="臨床心理學系"></option>
          <option value="地理學系"></option>
          <option value="東亞學系"></option>
          <option value="東南亞學系"></option>
          <option value="區域研究學系"></option>
          <option value="公共行政學系"></option>
          <option value="地政學系"></option>
          <option value="勞動關係與人力資源學系"></option>
          <option value="國際事務學系"></option>
          <option value="大眾傳播學系"></option>
          <option value="傳播管理學系"></option>
          <option value="運動資訊傳播學系"></option>
          <option value="新聞學系"></option>
          <option value="廣播電視學系"></option>
          <option value="公共關係學系"></option>
          <option value="圖書資訊學系"></option>
          <option value="圖文傳播學系"></option>
          <option value="廣告學系"></option>
          <option value="資訊傳播學系"></option>
          <option value="商業經營學系"></option>
          <option value="商業數據學系"></option>
          <option value="國際商務學系"></option>
          <option value="會計學系"></option>
          <option value="會計資訊學系"></option>
          <option value="企業管理學系"></option>
          <option value="國際企業學系"></option>
          <option value="管理科學學系"></option>
          <option value="科技管理學系"></option>
          <option value="國際貿易學系"></option>
          <option value="財務金融學系"></option>
          <option value="財務金融管理學系"></option>
          <option value="財務工程學系"></option>
          <option value="金融科技學系"></option>
          <option value="風險管理與保險學系"></option>
          <option value="財政學系"></option>
          <option value="不動產經營學系"></option>
          <option value="行銷與流通學系"></option>
          <option value="數位行銷學系"></option>
          <option value="行銷管理學系"></option>
          <option value="醫管學系"></option>
          <option value="健康產業管理學系"></option>
          <option value="法律學系"></option>
          <option value="海洋法律學系"></option>
          <option value="財經法律學系"></option>
          <option value="政治法律學系"></option>
          <option value="生命科學學系"></option>
          <option value="生物學系"></option>
          <option value="昆蟲學系"></option>
          <option value="微生物學系"></option>
          <option value="生物科技學系"></option>
          <option value="生物醫學學系"></option>
          <option value="海洋生物科技學系"></option>
          <option value="生物化學學系"></option>
          <option value="生化科技學系"></option>
          <option value="化學學系"></option>
          <option value="地球科學學系"></option>
          <option value="海洋科學學系"></option>
          <option value="物理學系"></option>
          <option value="大氣科學學系"></option>
          <option value="太空科學學系"></option>
          <option value="數學學系"></option>
          <option value="統計學系"></option>
          <option value="統計資訊學系"></option>
          <option value="資料科學學系"></option>
          <option value="資訊工程學系"></option>
          <option value="資訊科學學系"></option>
          <option value="資訊網路學系"></option>
          <option value="軟體工程學系"></option>
          <option value="資訊管理學系"></option>
          <option value="醫學資訊學系"></option>
          <option value="智慧工程學系"></option>
          <option value="電機工程學系"></option>
          <option value="光電工程學系"></option>
          <option value="半導體工程學系"></option>
          <option value="通訊工程學系"></option>
          <option value="電子工程學系"></option>
          <option value="造船工程學系"></option>
          <option value="能源工程學系"></option>
          <option value="冷凍空調與能源學系"></option>
          <option value="輪機工程學系"></option>
          <option value="生物機電工程學系"></option>
          <option value="機械工程學系"></option>
          <option value="車輛工程學系"></option>
          <option value="航空工程學系"></option>
          <option value="機電工程學系"></option>
          <option value="土木工程學系"></option>
          <option value="營建工程學系"></option>
          <option value="公共安全與消防學系"></option>
          <option value="空間資訊學系"></option>
          <option value="化學工程學系"></option>
          <option value="材料科學與工程學系"></option>
          <option value="材料科學學系"></option>
          <option value="工業工程與管理學系"></option>
          <option value="智慧製造工程學系"></option>
          <option value="工業教育學系"></option>
          <option value="工業管理學系"></option>
          <option value="紡織工程學系"></option>
          <option value="環境工程學系"></option>
          <option value="環境與安全衛生工程學系"></option>
          <option value="河海工程學系"></option>
          <option value="生醫工程學系"></option>
          <option value="醫療器材科技學系"></option>
          <option value="建築學系"></option>
          <option value="景觀設計學系"></option>
          <option value="都巿規劃學系"></option>
          <option value="農藝學系"></option>
          <option value="農場管理學系"></option>
          <option value="植物醫學學系"></option>
          <option value="農業科技學系"></option>
          <option value="土壤環境科學學系"></option>
          <option value="農業化學學系"></option>
          <option value="動物科學學系"></option>
          <option value="寵物美容與照護學系"></option>
          <option value="園藝學系"></option>
          <option value="農業經濟學系"></option>
          <option value="農企業管理學系"></option>
          <option value="生物產業管理學系"></option>
          <option value="食品科學學系"></option>
          <option value="食品安全與檢驗學系"></option>
          <option value="水產食品科學學系"></option>
          <option value="森林學系"></option>
          <option value="木材科學學系"></option>
          <option value="水產養殖學系"></option>
          <option value="漁業科學學系"></option>
          <option value="獸醫學系"></option>
          <option value="呼吸治療學系"></option>
          <option value="醫學學系"></option>
          <option value="中醫學系"></option>
          <option value="公共衛生學系"></option>
          <option value="職業安全衛生學系"></option>
          <option value="健康與衛生教育學系"></option>
          <option value="藥學學系"></option>
          <option value="藥用植物學系"></option>
          <option value="中國藥學學系"></option>
          <option value="化妝品科學學系"></option>
          <option value="生技製藥學系"></option>
          <option value="物理治療學系"></option>
          <option value="職能治療學系"></option>
          <option value="語言與聽力治療學系"></option>
          <option value="運動醫學學系"></option>
          <option value="營養學系"></option>
          <option value="護理學系"></option>
          <option value="醫學技術及檢驗學系"></option>
          <option value="醫學影像暨放射科學學系"></option>
          <option value="視光學系"></option>
          <option value="牙醫學系"></option>
          <option value="牙體技術學系"></option>
          <option value="口腔衛生學系"></option>
          <option value="長期照護與管理學系"></option>
          <option value="高齡健康照護學系"></option>
          <option value="老人服務事業管理學系"></option>
          <option value="社會工作學系"></option>
          <option value="醫學社會工作學系"></option>
          <option value="生命禮儀學系"></option>
          <option value="兒童保育學系"></option>
          <option value="家庭與兒童發展學系"></option>
          <option value="餐旅管理學系"></option>
          <option value="餐飲管理學系"></option>
          <option value="旅館管理學系"></option>
          <option value="餐飲廚藝學系"></option>
          <option value="觀光休閒學系"></option>
          <option value="觀光休閒管理學系"></option>
          <option value="休閒遊憩學系"></option>
          <option value="體育學系"></option>
          <option value="運動科學學系"></option>
          <option value="運動產業與管理學系"></option>
          <option value="運動與休閒管理學系"></option>
          <option value="運動與健康管理學系"></option>
          <option value="生活應用科學學系"></option>
          <option value="服飾設計學系"></option>
          <option value="服飾經營及管理學系"></option>
          <option value="時尚產業經營學系"></option>
          <option value="美容與造型設計學系"></option>
          <option value="化妝品應用與管理學系"></option>
          <option value="美髮學系"></option>
          <option value="運輸管理學系"></option>
          <option value="航空服務與管理學系"></option>
          <option value="飛行與航空作業學系"></option>
          <option value="空運管理學系"></option>
          <option value="航海學系"></option>
          <option value="航運管理學系"></option>
          <option value="環境資源學系"></option>
          <option value="水土保持學系"></option>
          <option value="生態人文學系"></option>
        </datalist>
        <button class="btn btn-tertiary" type="button" id="button-addon2"><i class="bi bi-search"></i></button>
      </div>
      <p id="resultdiv"></p>
      <button class="btn btn-secondary" type="button" id="btnClearSearch">清除搜尋 / 顯示全部</button>
    </div>
  </div>
  <div id="loadingMessage" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.9); padding: 20px; border: 1px solid rgb(204, 204, 204); border-radius: 8px; z-index: 9999; font-weight: bold;"> 🎨 圖形繪製中，請稍候… </div>
</form>
<script src="http://140.122.118.47/careerinfo/itemCs_full.js"></script> 
<script>
        console.log("開始讀取");
        const rawData = [
            { cat: '中國語文學類', dept: '中國語文學系', catintro:'中國語文學類主要研究中國語言和文學，包括古代和現代的語言結構、文學作品、文化背景及其演變。學生將學習如何分析和理解中國文學作品，並探討其在不同歷史時期的社會和文化意義。' },
            { cat: '中國語文學類', dept: '華語文學系', catintro: '中國語文學類主要研究中國語言和文學，包括古代和現代的語言結構、文學作品、文化背景及其演變。學生將學習如何分析和理解中國文學作品，並探討其在不同歷史時期的社會和文化意義。' },
            { cat: '國際事務學類', dept: '國際事務學系', catintro: '國際事務學類主要研究國際關係、全球政治經濟、外交政策及國際組織等議題。學生將學習如何分析和解決跨國界的問題，並理解不同國家之間的互動和影響。' },
            { cat: '一般大眾傳播學類', dept: '大眾傳播學系', catintro: '大眾傳播學類主要研究如何透過各種媒體（例如：電視、廣播、報紙、網路等）進行訊息傳遞和交流。這個學類涵蓋了新聞學、廣告學、公共關係、數位媒體等多個領域，旨在培養學生具備媒體製作、內容創作、廣告營銷及策略溝通等能力。' },
            { cat: '一般大眾傳播學類', dept: '傳播管理學系', catintro: '大眾傳播學類主要研究如何透過各種媒體（例如：電視、廣播、報紙、網路等）進行訊息傳遞和交流。這個學類涵蓋了新聞學、廣告學、公共關係、數位媒體等多個領域，旨在培養學生具備媒體製作、內容創作、廣告營銷及策略溝通等能力。' },
            { cat: '一般大眾傳播學類', dept: '運動資訊傳播學系', catintro: '大眾傳播學類主要研究如何透過各種媒體（例如：電視、廣播、報紙、網路等）進行訊息傳遞和交流。這個學類涵蓋了新聞學、廣告學、公共關係、數位媒體等多個領域，旨在培養學生具備媒體製作、內容創作、廣告營銷及策略溝通等能力。' },
            { cat: '圖書資訊檔案學類', dept: '圖書資訊學系', catintro: '圖書資訊檔案學類主要研究如何有效地管理、組織和檢索各種形式的資訊，包括書籍、期刊、電子資源和檔案。這個學類涵蓋了圖書館學、資訊科學和檔案管理等領域，旨在培養學生具備資訊組織、管理和服務的專業能力。' },
            { cat: '企業管理學類', dept: '企業管理學系', catintro: '企業管理學類主要研究如何有效地經營和管理一個組織或企業。這個學類涵蓋了多種管理領域，包括人力資源管理、財務管理、行銷管理、策略管理等。學生將學習如何制定計劃、組織資源、領導團隊以及控制和評估企業運作。' },
            { cat: '企業管理學類', dept: '國際企業學系', catintro: '企業管理學類主要研究如何有效地經營和管理一個組織或企業。這個學類涵蓋了多種管理領域，包括人力資源管理、財務管理、行銷管理、策略管理等。學生將學習如何制定計劃、組織資源、領導團隊以及控制和評估企業運作。' },
            { cat: '企業管理學類', dept: '管理科學學系', catintro: '企業管理學類主要研究如何有效地經營和管理一個組織或企業。這個學類涵蓋了多種管理領域，包括人力資源管理、財務管理、行銷管理、策略管理等。學生將學習如何制定計劃、組織資源、領導團隊以及控制和評估企業運作。' },
            { cat: '企業管理學類', dept: '科技管理學系', catintro: '企業管理學類主要研究如何有效地經營和管理一個組織或企業。這個學類涵蓋了多種管理領域，包括人力資源管理、財務管理、行銷管理、策略管理等。學生將學習如何制定計劃、組織資源、領導團隊以及控制和評估企業運作。' },
            { cat: '貿易學類', dept: '國際貿易學系', catintro: '貿易學類主要研究國際貿易理論與實務，涵蓋進出口業務、國際市場分析、貿易法規、物流管理等領域。學生將學習如何在全球市場中進行貿易活動，並了解不同國家的貿易政策和文化差異，以便有效地進行跨國交易。' },
            { cat: '都巿規劃學類', dept: '都巿規劃學系', catintro: '都市規劃學類主要研究如何有效地利用土地資源，設計和管理城市空間，以滿足居民的生活需求。這個學類涵蓋了從城市設計、交通規劃到環境保護等多方面的內容，目的是創造一個功能完善、環境友好且永續發展的城市。' },
            { cat: '老年服務學類', dept: '長期照護與管理學系', catintro: '老年服務學類主要研究如何提供高品質的服務與支持給老年人，涵蓋健康照護、心理支持、社會參與等多方面。這個學類旨在培養學生具備專業知識和技能，以應對老年人口日益增長所帶來的挑戰。' },
            { cat: '老年服務學類', dept: '高齡健康照護學系', catintro: '老年服務學類主要研究如何提供高品質的服務與支持給老年人，涵蓋健康照護、心理支持、社會參與等多方面。這個學類旨在培養學生具備專業知識和技能，以應對老年人口日益增長所帶來的挑戰。' },
            { cat: '老年服務學類', dept: '老人服務事業管理學系', catintro: '老年服務學類主要研究如何提供高品質的服務與支持給老年人，涵蓋健康照護、心理支持、社會參與等多方面。這個學類旨在培養學生具備專業知識和技能，以應對老年人口日益增長所帶來的挑戰。' },
            { cat: '兒童保育學類', dept: '兒童保育學系', catintro: '兒童保育學類主要研究和實踐如何照顧、教育和支持兒童的全面發展。這個學類涵蓋了從嬰幼兒到學齡前兒童的各種需求，包括身體、情感、社會和智力發展。學生將學習如何設計和實施適合不同年齡段兒童的教育和保育計劃。' },
            { cat: '兒童保育學類', dept: '家庭與兒童發展學系', catintro: '兒童保育學類主要研究和實踐如何照顧、教育和支持兒童的全面發展。這個學類涵蓋了從嬰幼兒到學齡前兒童的各種需求，包括身體、情感、社會和智力發展。學生將學習如何設計和實施適合不同年齡段兒童的教育和保育計劃。' },
            { cat: '觀光休閒學類', dept: '觀光休閒學系', catintro: '觀光休閒學類主要研究如何規劃、管理和推廣觀光與休閒活動。這個學類涵蓋了旅遊經濟學、國際觀光、市場行銷、文化資源管理等領域，目的是培養學生在這些領域的專業知識和實務技能。' },
            { cat: '觀光休閒學類', dept: '觀光休閒管理學系', catintro: '觀光休閒學類主要研究如何規劃、管理和推廣觀光與休閒活動。這個學類涵蓋了旅遊經濟學、國際觀光、市場行銷、文化資源管理等領域，目的是培養學生在這些領域的專業知識和實務技能。' },
            { cat: '觀光休閒學類', dept: '休閒遊憩學系', catintro: '觀光休閒學類主要研究如何規劃、管理和推廣觀光與休閒活動。這個學類涵蓋了旅遊經濟學、國際觀光、市場行銷、文化資源管理等領域，目的是培養學生在這些領域的專業知識和實務技能。' }
        ];

        const grouped = {};
        rawData.forEach(item => {
            if (!grouped[item.cat]) grouped[item.cat] = [];
            grouped[item.cat].push(item.dept);
        });

        const treeDiv = document.getElementById("treeMenu");
        let index = 1;
        // 建立 tooltip 容器
        const tooltip = document.createElement("div");
        tooltip.style.position = "absolute";
        tooltip.style.padding = "8px";
        tooltip.style.background = "#f9f9f9";
        tooltip.style.border = "1px solid #ccc";
        tooltip.style.borderRadius = "5px";
        tooltip.style.boxShadow = "0 2px 8px rgba(0,0,0,0.15)";
        tooltip.style.maxWidth = "250px";
        tooltip.style.fontSize = "13px";
        tooltip.style.lineHeight = "1.5";
        tooltip.style.display = "none";
        tooltip.style.zIndex = 999;
        document.body.appendChild(tooltip);

        for (const cat in grouped) {
            const wrapper = document.createElement("div");
            wrapper.style.marginBottom = "10px";

            const catTitle = document.createElement("div");
            catTitle.textContent = `${index}. ${cat}`;
            catTitle.style.cursor = "pointer";
            catTitle.style.fontWeight = "bold";
            catTitle.style.color = "#3366cc";
            catTitle.style.marginBottom = "4px";

            const ul = document.createElement("ul");
            ul.style.marginLeft = "20px";
            ul.style.display = "none";

            grouped[cat].forEach((dept, i) => {
                const li = document.createElement("li");
                li.textContent = ` ${dept}`;
                ul.appendChild(li);
            });

            // 顯示 tooltip
            catTitle.addEventListener("mouseover", function (e) {
                const item = rawData.find(x => x.cat === cat);
                if (item && item.catintro) {
                    tooltip.innerText = item.catintro;
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY + 10}px`;
                    tooltip.style.display = "block";
                }
            });

            catTitle.addEventListener("mousemove", function (e) {
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY + 10}px`;
            });

            catTitle.addEventListener("mouseout", function () {
                tooltip.style.display = "none";
            });

            // 點擊類別名稱：閃爍並收合/展開 
            catTitle.addEventListener("click", function () {
                const isHidden = ul.style.display === "none";
                ul.style.display = isHidden ? "block" : "none";
                if (isHidden) {
                    highlightPointsByNamePart(cat);
                }
            });

            wrapper.appendChild(catTitle);
            wrapper.appendChild(ul);
            treeDiv.appendChild(wrapper);
            index++;
        }
        //for (const cat in grouped) {
        //    const wrapper = document.createElement("div");
        //    wrapper.style.marginBottom = "10px";

        //    const catTitle = document.createElement("div");
        //    catTitle.textContent = `${index}. ${cat}`;
        //    catTitle.style.cursor = "pointer";
        //    catTitle.style.fontWeight = "bold";
        //    catTitle.style.color = "#3366cc";
        //    catTitle.style.marginBottom = "4px";

        //    //const ul = document.createElement("ul");
        //    //ul.style.marginLeft = "20px";
        //    //ul.style.display = "none"; // ✅ 預設收合

        //    //grouped[cat].forEach((dept, i) => {
        //    //    const li = document.createElement("li");
        //    //    li.textContent = ` ${dept}`;
        //    //    ul.appendChild(li);
        //    //});
        //    // 加入滑鼠提示文字
        //    const catIntro = rawData.find(item => item.cat === cat)?.catintro || "";
        //    catTitle.title = catIntro;

        //    const ul = document.createElement("ul");
        //    ul.style.marginLeft = "20px";
        //    ul.style.display = "none";

        //    grouped[cat].forEach((dept, i) => {
        //        const li = document.createElement("li");
        //        li.textContent = ` ${dept}`;
        //        ul.appendChild(li);
        //    });

        //    // ✅ 點擊類別名稱：閃爍並收合/展開
        //    catTitle.addEventListener("click", function () {
        //        const isHidden = ul.style.display === "none";
        //        ul.style.display = isHidden ? "block" : "none";
        //        if (isHidden) {
        //            // 展開時才執行閃爍
        //            highlightPointsByNamePart(cat);
        //        }
        //    });

        //    wrapper.appendChild(catTitle);
        //    wrapper.appendChild(ul);
        //    treeDiv.appendChild(wrapper);
        //    index++;
        //}

        // === 🔔 依名稱片段搜尋並閃爍所有符合的點 ===
        function highlightPointsByNamePart(keyword) {
            const allData = myDiv.data;

            allData.forEach((trace, traceIndex) => {
                if (trace.text) {
                    trace.text.forEach((text, pointIndex) => {
                        if (text.includes(keyword)) {
                            blinkPoint(traceIndex, pointIndex, 3, 150);
                        }
                    });
                }
            });
        }

        function blinkPoint(traceIndex, pointIndex, blinkCount, interval) {
            var traceData = myDiv.data[traceIndex];

            let sizeArray = (typeof traceData.marker.size === 'number')
                ? new Array(traceData.x.length).fill(traceData.marker.size)
                : [...traceData.marker.size];

            let colorArray = (typeof traceData.marker.color === 'string')
                ? new Array(traceData.x.length).fill(traceData.marker.color)
                : [...traceData.marker.color];

            const originalSize = sizeArray[pointIndex];
            const originalColor = colorArray[pointIndex];

            let count = 0;
            let visible = false;

            const timer = setInterval(function () {
                // sizeArray[pointIndex] = visible ? 20 : 7;
                sizeArray[pointIndex] = visible ? 20 : 7;
                colorArray[pointIndex] = visible ? 'red' : 'rgba(255,0,0,0.05)';

                Plotly.restyle('myDiv', {
                    'marker.size': [sizeArray],
                    'marker.color': [colorArray]
                }, [traceIndex]);

                visible = !visible;
                count++;

                if (count >= blinkCount * 2) {
                    clearInterval(timer);
                    sizeArray[pointIndex] = originalSize;
                    colorArray[pointIndex] = originalColor;

                    Plotly.restyle('myDiv', {
                        'marker.size': 7,
                        'marker.color': [colorArray]
                    }, [traceIndex]);
                }
            }, interval);
        }



        // 產生 datalist 選項
        const dataList = document.getElementById("Drop_dept");
        itemCs.forEach(item => {
            if (item.ccont) {
                const option = document.createElement("option");
                option.value = item.ccont;
                dataList.appendChild(option);
            }
        });



        document.getElementById("btnClearSearch").addEventListener("click", function () {
            // 清除搜尋欄位與結果文字
            document.getElementById("Searchdeptstr").value = "";
            document.getElementById("resultdiv").innerHTML = "";

            // 定義學類名稱與對應顏色
            const colorMap = {
                "近": "#008080",
                "中": "#FFD700",
                "遠": "#4B0082"
            };


            // 回復所有點與文字
            myDiv.data.forEach((trace, traceIndex) => {
                if (["近", "中", "遠"].includes(trace.name)) {
                    const originalSize = 7;
                    const sizeArray = new Array(trace.x.length).fill(originalSize);
                    const colorArray = new Array(trace.x.length).fill(colorMap[trace.name]);
                    const textArray = trace.text_raw || [...trace.text];  // 使用原始備份的 text，如果有的話


                    // 若第一次還沒有備份 text_raw，備份起來
                    if (!trace.text_raw) {
                        trace.text_raw = [...trace.text];
                    }

                    Plotly.restyle('myDiv', {
                        'marker.size': 7,
                        'marker.color': [colorArray],
                        'text': [trace.text_raw]
                    }, [traceIndex]);
                }
            });
        });

        function removeHtmlTags(str) {
            // return str.replace(/<[^>]*>/g, '');
            return str.replace(/<b>\d+<\/b>\s*/g, '').trim();
        }
        // 點擊搜尋後觸發
        document.getElementById("button-addon2").addEventListener("click", function () {

            const inputStr = document.getElementById("Searchdeptstr").value.trim();
            if (!inputStr) return;

            // 進行模糊搜尋
            const matched = itemCs.filter(item => removeHtmlTags(item.ccont).includes(inputStr));
            const resultDiv = document.getElementById("resultdiv");

            if (matched.length === 0) {
                resultDiv.innerHTML = `查無與「${inputStr}」相關的學系資料。`;
                return;
            }

            // 收集對應的 bcont 去除重複
            //const resultSet = new Set();
            //matched.forEach(item => resultSet.add(item.bcont));

            // 去除重複 bcont（學類）
            //const resultSet = new Set();
            //matched.forEach(item => resultSet.add(item.bcont));
            //const resultText = Array.from(resultSet).join(" / ");


            // 輸出結果

            // 顯示輸出文字
  //          resultDiv.innerHTML = `
  //  「<strong>${inputStr}</strong>」科系分類在 <strong>${resultText}</strong> ，
  //  此學類與你特質的適配度為 <strong>AA</strong>。
  //`;
            //const resultText = Array.from(resultSet).join(" / ");



            // alert("對應的學類為：\n" + resultText);



            // 收集學類與學系名稱
            const matchBcontSet = new Set();
            const matchCcontSet = new Set();
            matched.forEach(item => {
                matchBcontSet.add(item.bcont);
                matchCcontSet.add(item.ccont);
            });

            const resultList = Array.from(matchBcontSet);


          //  const resultText = Array.from(matchBcontSet).join(" / ");
         //   resultDiv.innerHTML = `「<strong>${inputStr}</strong>」科系分類在 <strong>${resultText}</strong> 學類，此學類與你特質的適配度為 <strong>AA</strong>。`;
            if (resultList.length === 1) {
                // ✅ 單一學類：正常輸出
                resultDiv.innerHTML = `
        「<strong>${inputStr}</strong>」科系分類在 
        <strong>${resultList[0]}</strong> ，此學類與你特質的適配度為 <strong>AA</strong>。
           <br/>（適配度為50以上建議優先探索）
    `;
            } else {
                //  多學類輸出，僅列前 10 筆
                let html = `「<strong>${inputStr}</strong>」科系分類在：<br/>`;

                const displayLimit = 10;
                const limitedList = resultList.slice(0, displayLimit);

                limitedList.forEach((cat, i) => {
                    html += `<strong>${cat}</strong>  (適配度為 <strong>AA${i + 1}</strong>)<br/>`;
                });

                if (resultList.length > displayLimit) {
                    html += `...等共 <strong>${resultList.length}</strong> 類。`;
                }
                html += `<br/>以上學類的適配度若為50以上建議優先探索。`;
                resultDiv.innerHTML = html;
            }



            // 處理近 / 中 / 遠 三個 trace
            myDiv.data.forEach((trace, traceIndex) => {
                if (["近", "中", "遠"].includes(trace.name)) {
                    // ✅ 第一次搜尋前備份原始文字
                    if (!trace.text_raw) {
                        trace.text_raw = [...trace.text];
                    }
              
                    
                    //console.log(matchBcontSet);
                    const newSizes = [];
                  //  const newColors = [];
                    const newTexts = [];

                    trace.text.forEach((text, pointIndex) => {
                        if (matchBcontSet.has(removeHtmlTags(text))) {
                            newSizes.push(15); // 顯示大小
                           // newColors.push(trace.marker.color); // 原顏色
                            newTexts.push(text); // 顯示文字
                         //   console.log("符合", text, removeHtmlTags(text));
                        } else {
                            newSizes.push(1); // 隱藏
                          //  newColors.push(trace.marker.color);
                            newTexts.push(''); // 隱藏文字
                          //  console.log("不符合", text, removeHtmlTags(text));
                        }
                    });


                    Plotly.restyle('myDiv', {
                        'marker.size': [newSizes] ,
                        'text': [newTexts]
                    }, [traceIndex]);
                }
            });


        });









        // 使用 d3.js 載入 CSV 檔案
        d3.csv("data1.csv").then(function (data) {
            var plotData = [];
            var colorMap = {
                "Teal": "#008080",
                "Golden Yellow": "#FFD700",
                "Indigo": "#4B0082",
                "Red": "#FF0000"
            };

            // 定義名稱對應
            var nameMap = {
                "#008080": "近",
                "#FFD700": "中",
                "#4B0082": "遠",
                "#FF0000": "本人"
            };

            // 依據顏色分類點資料
            var colorGroups = {};
            data.forEach(function (row) {
                var color = row.color;
                var mappedColor = colorMap[color] || "#000000"; // 預設為黑色，如果無法匹配

                // 如果該顏色尚未初始化，則初始化結構
                if (!colorGroups[mappedColor]) {
                    colorGroups[mappedColor] = {
                        x: [],
                        y: [],
                        z: [],
                        text: [],
                        color: mappedColor,
                        links: []
                    };
                }

                // 添加座標與標籤到對應顏色的組中
                colorGroups[mappedColor].x.push(parseFloat(row.x));
                colorGroups[mappedColor].y.push(parseFloat(row.y));
                colorGroups[mappedColor].z.push(parseFloat(row.z));
                colorGroups[mappedColor].text.push(row.cname);
                colorGroups[mappedColor].links.push(row.link);
            });

            // 將每個顏色組的資料轉換為 Plotly 可用的格式
            Object.keys(colorGroups).forEach(function (color) {
                var group = colorGroups[color];
                plotData.push({
                    x: group.x,
                    y: group.y,
                    z: group.z,
                    mode: 'markers+text',
                    marker: {
                        size: 7,
                        color: group.color,
                        line: {
                            color: 'rgba(217, 217, 217, 0.14)',
                            width: 0.5
                        },
                        opacity: 0.8
                    },
                    type: 'scatter3d',
                    text: group.text,
                    textposition: 'top center',
                    hoverinfo: 'text',
                    customdata: group.links,
                    hovertemplate: '<span><a href="http://140.122.118.47/CareerInfo/explore2.aspx?cate=%{customdata}" target="_blank" style="color:white; font-weight:bold;font-size:24px;">%{text}</a></span><extra></extra>',
                    name: nameMap[color] || "未定義"
                });
            });



            // 添加「自由」和「規準」的標示
            plotData.push({
                x: [2.2, -2.2, 0, 0, 0, 0],
                y: [0, 0, 2.2, -2.2, 0, 0],
                z: [0, 0, 0, 0, 2.2, -2.2],
                mode: 'markers+text',
                type: 'scatter3d',
                text: ['自由(X+)', '規準(X-)', '事(Y+)', '人(Y-)', '思考(Z+)', '實作(Z-)'],
                textposition: 'top center',
                hoverinfo: 'none',
                marker: {
                    size: 4,
                    color: 'lightgray',             // ✅ 淺灰色
                    opacity: 0.8
                }, name: '空間軸標示',
                showlegend: true,                   // ✅ 顯示圖例
                legendgroup: 'axes'                 // ✅ 可加這行避免重複
            });



            // 佈局配置
            //var layout = {
            //    legend: {
            //        x: 1.05,   // 超出圖表右邊
            //        y: 0.5,
            //        xanchor: 'left',
            //        orientation: 'v'
            //    },
            //    margin: {
            //        l: 0,
            //        r: 0,
            //        b: 0,
            //        t: 0
            //    },
            //    scene: {
            //        xaxis: {
            //            title: {
            //                text: 'X 軸',
            //                font: { size: 14 }
            //            },
            //            tickfont: {
            //                color: 'rgba(128, 128, 128, 0.7)', // 灰色且透明
            //                size: 12
            //            }
            //        },
            //        yaxis: {
            //            title: {
            //                text: 'Y 軸',
            //                font: { size: 14 }
            //            },
            //            tickfont: {
            //                color: 'rgba(128, 128, 128, 0.7)', // 灰色且透明
            //                size: 12
            //            }
            //        },
            //        zaxis: {
            //            title: {
            //                text: 'Z 軸',
            //                font: { size: 14 }
            //            },
            //            tickfont: {
            //                color: 'rgba(128, 128, 128, 0.7)', // 灰色且透明
            //                size: 12
            //            }
            //        },
            //        camera: {
            //            eye: { x: 0.2838, y: -1.104, z: 0.305 }//,    up: { x: 0, y: 0, z:1 }
            //        }
            //    }
            //};
            function generateSphereWireframe(radius, step) {
                const lines = [];
                const phiStep = step;
                const thetaStep = step;

                for (let phi = 0; phi <= Math.PI; phi += phiStep) {
                    const x = [], y = [], z = [];
                    for (let theta = 0; theta <= 2 * Math.PI; theta += thetaStep) {
                        x.push(radius * Math.sin(phi) * Math.cos(theta));
                        y.push(radius * Math.sin(phi) * Math.sin(theta));
                        z.push(radius * Math.cos(phi));
                    }
                    lines.push({
                        type: 'scatter3d',
                        mode: 'lines',
                        x, y, z,
                        line: { color: 'lightgray', width: 1 },
                        hoverinfo: 'skip',
                        showlegend: false
                    });
                }

                for (let theta = 0; theta <= Math.PI; theta += thetaStep) {
                    const x = [], y = [], z = [];
                    for (let phi = 0; phi <= Math.PI; phi += phiStep) {
                        x.push(radius * Math.sin(phi) * Math.cos(theta));
                        y.push(radius * Math.sin(phi) * Math.sin(theta));
                        z.push(radius * Math.cos(phi));
                    }
                    lines.push({
                        type: 'scatter3d',
                        mode: 'lines',
                        x, y, z,
                        line: { color: 'lightgray', width: 1 },
                        hoverinfo: 'skip',
                        showlegend: false
                    });
                }

                return lines;
            }

            // 加入外圍光暈星點效果
            function generateOuterGlowPoints(numPoints, minR, maxR) {
                const x = [], y = [], z = [];
                for (let i = 0; i < numPoints; i++) {
                    const theta = Math.random() * 2 * Math.PI;
                    const phi = Math.acos(2 * Math.random() - 1);
                    const r = minR + Math.random() * (maxR - minR);
                    x.push(r * Math.sin(phi) * Math.cos(theta));
                    y.push(r * Math.sin(phi) * Math.sin(theta));
                    z.push(r * Math.cos(phi));
                }
                return [{
                    type: 'scatter3d',
                    mode: 'markers',
                    x, y, z,
                    marker: {
                        size: 6,
                        color: 'rgba(255, 100, 255, 0.7)',
                        opacity: 0.3
                    },
                    hoverinfo: 'skip',
                    showlegend: false
                }];
            }


            console.log("開始畫圖");
            const loadingDiv = document.getElementById("loadingMessage");
            loadingDiv.style.display = "block"; // ✅ 顯示載入提示
            // 在網頁上繪製圖形
            // Plotly.newPlot('myDiv', plotData, layout);
            Plotly.newPlot('myDiv', [
                ...plotData,
                ...generateSphereWireframe(2.2, 0.2)
            ], {
                scene: {
                    xaxis: { visible: false },
                    yaxis: { visible: false },
                    zaxis: { visible: false },
                    bgcolor: 'rgba(255,255,255,1)',
                    camera: { eye: { x: 0.8, y: 0.8, z: 0.8 } }
                },
                paper_bgcolor: 'white',
                plot_bgcolor: 'white',
                margin: { l: 0, r: 0, b: 0, t: 0 },
                legend: {
                    x: 1.05,
                    y: 0.5,
                    xanchor: 'left',
                    orientation: 'v'
                }
            });


            console.log("結束畫圖");


            loadingDiv.style.display = "none";

            document.getElementById('myDiv').on('plotly_click', function (data) {
                var point = data.points[0]; // 只處理第一個點（一般點一個點即可）
                var name = point.text; // cname 對應的值
                console.log("你點擊了座標名稱：" + name);



            });

            // 自動旋轉控制
            var rotating = false;
            var rotationInterval;
            var currentEye = { x: 0.2838, y: -1.104, z: 0.305 };

            function startRotation() {
                rotating = true;
                rotationInterval = setInterval(function () {
                    const angle = 0.005;
                    const cosA = Math.cos(angle);
                    const sinA = Math.sin(angle);

                    // 更新視角（保持相對位置）
                    const newX = cosA * currentEye.x - sinA * currentEye.y;
                    const newY = sinA * currentEye.x + cosA * currentEye.y;
                    currentEye.x = newX;
                    currentEye.y = newY;

                    Plotly.relayout('myDiv', {
                        'scene.camera.eye': currentEye
                    });
                }, 20);
            }

            function stopRotation() {
                rotating = false;
                clearInterval(rotationInterval);
            }

            document.getElementById('toggleRotation').addEventListener('click', function () {
                if (rotating) {
                    stopRotation();
                    this.textContent = '旋轉展示';
                } else {
                    startRotation();
                    this.textContent = '暫停旋轉';
                }
            });

            // 點擊按鈕後，強調特定點
            document.getElementById('highlightBtn').addEventListener('click', function () {
                //highlightPoint(0, 11); // 這裡可以改成你想要強調的 trace 與點 index
                blinkPoint(0, 11, 5, 200);
            });

            // 定義函式：將指定 trace 的指定點改為大紅色
            function highlightPoint(traceIndex, pointIndex) {
                var traceData = myDiv.data[traceIndex];

                // 若 marker.size 為單一數字，需轉成陣列
                var originalSize = (typeof traceData.marker.size === 'number')
                    ? new Array(traceData.x.length).fill(traceData.marker.size)
                    : [...traceData.marker.size];
                var originalColor = (typeof traceData.marker.color === 'string')
                    ? new Array(traceData.x.length).fill(traceData.marker.color)
                    : [...traceData.marker.color];

                // 修改指定點
                originalSize[pointIndex] = 30;
                originalColor[pointIndex] = 'red';

                // 套用更新
                Plotly.restyle('myDiv', {
                    'marker.size': [originalSize],
                    'marker.color': [originalColor]
                }, [traceIndex]);
            }

            function blinkPoint(traceIndex, pointIndex, blinkCount, interval) {
                var traceData = myDiv.data[traceIndex];

                // 確保 size 與 color 是陣列格式（針對每個點）
                let sizeArray = (typeof traceData.marker.size === 'number')
                    ? new Array(traceData.x.length).fill(traceData.marker.size)
                    : [...traceData.marker.size];

                let colorArray = (typeof traceData.marker.color === 'string')
                    ? new Array(traceData.x.length).fill(traceData.marker.color)
                    : [...traceData.marker.color];

                // ✅ 儲存該點的原始樣式
                const originalSize = sizeArray[pointIndex];
                const originalColor = colorArray[pointIndex];

                console.log("sizeArray", sizeArray);
                console.log("originalSize", originalSize);

                let count = 0;
                let visible = false;

                const timer = setInterval(function () {
                    // ✅ 只改變該點的大小與顏色，其他不變
                    sizeArray[pointIndex] = visible ? 20 : 7;
                    colorArray[pointIndex] = visible ? 'red' : 'rgba(255,0,0,0.05)';

                    Plotly.restyle('myDiv', {
                        'marker.color': [colorArray]
                    }, [traceIndex]);

                    visible = !visible;
                    count++;

                    if (count >= blinkCount * 2) {
                        clearInterval(timer);

                        // ✅ 還原該點的樣式
                        colorArray[pointIndex] = originalColor;

                        Plotly.restyle('myDiv', {
                            'marker.color': [colorArray]
                        }, [traceIndex]);
                    }
                }, interval);
            }


        });
    </script>
<div style="position: absolute; padding: 8px; background: rgb(249, 249, 249); border: 1px solid rgb(204, 204, 204); border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.15) 0px 2px 8px; max-width: 250px; font-size: 13px; line-height: 1.5; display: none; z-index: 999; left: 1891px; top: 450px;">中國語文學類主要研究中國語言和文學，包括古代和現代的語言結構、文學作品、文化背景及其演變。學生將學習如何分析和理解中國文學作品，並探討其在不同歷史時期的社會和文化意義。</div>
<svg id="js-plotly-tester" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="position: absolute; left: -10000px; top: -10000px; width: 9000px; height: 9000px; z-index: 1;">
  <path class="js-reference-point" d="M0,0H1V1H0Z" style="stroke-width: 0; fill: black;"></path>
</svg>
</body>
</html>